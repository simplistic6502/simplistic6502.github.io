<!DOCTYPE html>
<!-- saved from url=(0038)https://www.smbpedia.com/wiki/Movement -->
<html class="client-js ve-available" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/main.css">
<title>Movement - SMBpedia</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"ZW1Dz_5kohpxjE8qRSX5WgAAARQ","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Movement","wgTitle":"Movement","wgCurRevisionId":236,"wgRevisionId":236,"wgArticleId":52,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Movement","wgRelevantArticleId":52,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},
"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false},"wgVector2022PreviewPages":[],"wgEditSubmitButtonLabelPublish":false};RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","skins.vector.styles.legacy":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});</script>
<link rel="stylesheet" href="./Movement - SMBpedia_files/load.php">
<script async="" src="./Movement - SMBpedia_files/load(1).php"></script>
<meta name="generator" content="MediaWiki 1.40.1">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<link rel="icon" href="https://www.smbpedia.com/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://www.smbpedia.com/opensearch_desc.php" title="SMBpedia (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://www.smbpedia.com/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="SMBpedia Atom feed" href="https://www.smbpedia.com/index.php?title=Special:RecentChanges&amp;feed=atom">
<style>
.mw-editfont-monospace{font-family:monospace,monospace}.mw-editfont-sans-serif{font-family:sans-serif}.mw-editfont-serif{font-family:serif} .mw-editfont-monospace,.mw-editfont-sans-serif,.mw-editfont-serif{  font-size:13px;  -moz-tab-size:4; tab-size:4; }.mw-editfont-monospace.oo-ui-textInputWidget,.mw-editfont-sans-serif.oo-ui-textInputWidget,.mw-editfont-serif.oo-ui-textInputWidget{font-size:inherit}.mw-editfont-monospace.oo-ui-textInputWidget > .oo-ui-inputWidget-input,.mw-editfont-sans-serif.oo-ui-textInputWidget > .oo-ui-inputWidget-input,.mw-editfont-serif.oo-ui-textInputWidget > .oo-ui-inputWidget-input{  font-size:13px}.mw-editfont-monospace.oo-ui-textInputWidget > input.oo-ui-inputWidget-input,.mw-editfont-sans-serif.oo-ui-textInputWidget > input.oo-ui-inputWidget-input,.mw-editfont-serif.oo-ui-textInputWidget > input.oo-ui-inputWidget-input{min-height:32px}
.ve-init-mw-progressBarWidget{height:1em;overflow:hidden;margin:0 25%}.ve-init-mw-progressBarWidget-bar{height:1em;width:0} .ve-init-mw-progressBarWidget{background-color:#fff;box-sizing:border-box;height:0.875em;border:1px solid #36c;border-radius:0.875em;box-shadow:0 1px 1px rgba(0,0,0,0.15)}.ve-init-mw-progressBarWidget-bar{background-color:#36c;height:0.875em}
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><style>
.ve-init-mw-tempWikitextEditorWidget{border:0;padding:0;color:inherit;line-height:1.5em;width:100%; -moz-tab-size:4; tab-size:4; }.ve-init-mw-tempWikitextEditorWidget:focus{outline:0;padding:0}.ve-init-mw-tempWikitextEditorWidget::selection{background:rgba(109,169,247,0.5); }</style><style>
.ve-active .ve-init-mw-desktopArticleTarget-targetContainer #siteNotice,.ve-active .mw-indicators,.ve-active #t-print,.ve-active #t-permalink,.ve-active #p-coll-print_export,.ve-active #t-cite,.ve-active .ve-init-mw-desktopArticleTarget-editableContent,.ve-active .ve-init-mw-tempWikitextEditorWidget{display:none}.ve-deactivating .ve-ui-surface{display:none}.ve-activating{ }.ve-activating .ve-ui-surface{height:0;padding:0 !important; overflow:hidden} .ve-loading .ve-init-mw-desktopArticleTarget-targetContainer > :not(.ve-init-mw-desktopArticleTarget-toolbarPlaceholder):not(.ve-init-mw-desktopArticleTarget),.ve-loading .ve-init-mw-desktopArticleTarget-originalContent,.ve-activated:not(.ve-loading) .ve-init-mw-desktopArticleTarget-uneditableContent{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.5}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading{ -webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;pointer-events:auto;cursor:text}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading a{ pointer-events:none}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks{cursor:pointer}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks:hover{ background:#e9f2fd}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks a{opacity:1} .ve-init-mw-desktopArticleTarget-loading-overlay{z-index:2;position:absolute;width:100%;top:1em}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{overflow:hidden;transition:height 250ms ease;height:0;padding-bottom:2px; }.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(-100%);transition:transform 250ms ease}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(0)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{transition:none}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{position:fixed;top:0;z-index:1;background:#fff} .oo-ui-element-hidden{display:none !important; } .mw-editsection{ unicode-bidi:-moz-isolate;unicode-bidi:-webkit-isolate;unicode-bidi:isolate}.mw-editsection:before{content:'\200B'}.mw-editsection a{white-space:nowrap}.mw-editsection-divider{color:#54595d} .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{height:42px;border-bottom:1px solid #c8ccd1;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open{height:42px} .ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{font-size:0.875em; margin:-1.14em -1.14em 1.14em -1.14em; }@media screen and (min-width:982px){.ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{ margin:-1.43em -1.71em 1.43em -1.71em}}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{margin-top:0;margin-bottom:0} .ve-activated .vector-menu-tabs .selected{box-shadow:inset 0 -1px 0 #e1f1fc}</style></head>
<body class="skin-vector-legacy mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Movement rootpage-Movement skin-vector action-view"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body ve-init-mw-desktopArticleTarget-targetContainer" role="main">
	<a id="top"></a>
	<div id="siteNotice"></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Movement</span></h1>
    <div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Horizontal_Movement"><span class="tocnumber">1</span> <span class="toctext">Horizontal Movement</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Acceleration"><span class="tocnumber">1.1</span> <span class="toctext">Acceleration</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#Explanation"><span class="tocnumber">1.1.1</span> <span class="toctext">Explanation</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#Exploits"><span class="tocnumber">1.1.2</span> <span class="toctext">Exploits</span></a>
<ul>
<li class="toclevel-4 tocsection-5"><a href="#Fast_Acceleration"><span class="tocnumber">1.1.2.1</span> <span class="toctext">Fast Acceleration</span></a></li>
<li class="toclevel-4 tocsection-6"><a href="#Subspeed_manipulation"><span class="tocnumber">1.1.2.2</span> <span class="toctext">Subspeed manipulation</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Speed_resets"><span class="tocnumber">1.2</span> <span class="toctext">Speed resets</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Miscellaneous"><span class="tocnumber">1.3</span> <span class="toctext">Miscellaneous</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Wind_(SMB2J)"><span class="tocnumber">1.4</span> <span class="toctext">Wind (SMB2J)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Vertical_movement"><span class="tocnumber">2</span> <span class="toctext">Vertical movement</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Speed_cap"><span class="tocnumber">2.1</span> <span class="toctext">Speed cap</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Gravity"><span class="tocnumber">2.2</span> <span class="toctext">Gravity</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Speed_resets_2"><span class="tocnumber">2.3</span> <span class="toctext">Speed resets</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Horizontal_Movement">Horizontal Movement</span></h2>
<p>At any point, Mario may be moving left or right, determined by the sign of his speed (<code>Player_X_Speed</code>). His speed is measured in subpixels/frame. In non-water areas, his speed is hard capped at ±40 when <code>RunningTimer</code> is set, or soft capped at ±24 otherwise. In water areas, his speed is always hard capped at ±24, and soft capped at ±16 on the ground. Note that a "soft cap" refers to the fact that in practice it is possible to exceed this cap by holding either no directional inputs or the opposite of the directional input corresponding to the direction Mario is traveling. An exception exists during the pipe entrance cutscenes (where <code>GameEngineSubroutine == 7</code>) where Mario's speed is hard capped to 12.
</p><p>Mario's subspeed (<code>Player_X_MoveForce</code>) is only used in calculating acceleration, and does not contribute to updating his position.
</p><p><code>RunningTimer</code> is always set to 10 when B is held, Mario is on the ground and the directional inputs held correspond to the direction Mario is moving (<code>Left_Right_Buttons == Player_MovingDir</code>, where <code>Left_Right_Buttons</code> is set to <code>SavedJoypadBits &amp; 0x03</code>). It decrements by 1 every frame these conditions aren't met. 
</p>
<h3><span class="mw-headline" id="Acceleration">Acceleration</span></h3>
<h4><span class="mw-headline" id="Explanation">Explanation</span></h4>
<p>Mario's horizontal acceleration is stored in <code>FrictionAdderHigh</code> and <code>FrictionAdderLow</code>, following this algorithm:
</p>
<pre>$00&nbsp;:= 0

<b>if</b> Player_State&nbsp;!= 0 <b>then</b> /* if Mario is in the air */
    <b>if</b> Player_XSpeedAbsolute &lt; 25 <b>then</b>
        $00&nbsp;:= $00 + 1
        
        <b>if</b> RunningSpeed <b>then</b> /* RunningSpeed is set if Player_XSpeedAbsolute &gt;= 28 and is only unset if Left_Right_Buttons == Player_MovingDir and Player_XSpeedAbsolute &lt; 28 */
            $00&nbsp;:= $00 + 1
        <b>end</b>
    <b>end</b>
<b>else</b> /* if Mario is on the ground */
    <b>if</b> AreaType == 0 <b>then</b> /* if in water area */
        $00&nbsp;:= $00 + 1
    <b>else</b> <b>if</b> Left_Right_Buttons&nbsp;!= Player_MovingDir <b>then</b>
        $00&nbsp;:= $00 + 1
        
        <b>if</b> RunningSpeed <b>then</b>
            $00&nbsp;:= $00 + 1
        <b>end</b>
    <b>else</b> <b>if</b>&nbsp;!(A_B_Buttons &amp; #B_Button) <b>and</b> !RunningTimer <b>then</b> /* If B button is not pressed and RunningTimer is not set */
        $00&nbsp;:= $00 + 1
    <b>end</b>
<b>end</b>

FrictionAdderLow&nbsp;:= FrictionData[$00] /* db[0xe4, 0x98, 0xd0] */
FrictionAdderHigh&nbsp;:= 0

<b>if</b> PlayerFacingDir&nbsp;!= Player_MovingDir <b>then</b>
    /* Double Acceleration */
    FrictionAdderLow&nbsp;:= FrictionAdderLow &lt;&lt; 1 /* Rolls bit 7 into carry */
    FrictionAdderHigh&nbsp;:= FrictionAdderHigh &lt;&lt; 1 /* Rolls carry bit in */
<b>end</b>
</pre>
<p>Note that pressing L+R sets <code>PlayerFacingDir</code> to 3 (0b00000011), but <code>Player_MovingDir</code> is based solely on the sign of Mario's speed. This means that when L+R is pressed, Mario's horizontal acceleration will always be double it's original value.
</p><p>Mario's horizontal acceleration is then applied first to subspeed then to his speed depending on the sign of his speed and directional inputs (note that if Mario's speed is zero, his subspeed will not be updated if no buttons are held; see the last entry of <a href="#Speed_resets">#Speed resets</a>). His speed is then capped to his maximum speed which depends on if <code>RunningTimer</code> is set.
</p>
<h4><span class="mw-headline" id="Exploits">Exploits</span></h4>
<h5><span class="mw-headline" id="Fast_Acceleration">Fast Acceleration</span></h5>
<p>As Mario accelerates faster when he is facing the opposite direction he is going, one can deliberately take advantage of this, performing a trick called a fast acceleration. TASes usually perform what's called a L+R fast acceleration, where the inputs <code>L+R, R+A</code> are performed at the beginning of a section. RTA runners, who are either console runners physically unable to press the Left and Right D-pad buttons together, or emulator players who follow a no L+R rule present on most speedrun leaderboards can still perform a fast acceleration, by performing the inputs <code>L, [nothing], R+A</code>. Note that [nothing] means no Left, Right, or A inputs, as at least one other button has to be held (see the last entry of <a href="#Speed_resets">#Speed resets</a>). The same idea is then applied by both RTA runners and TASers to gain maximum running speed quicker.
</p>
<h5><span class="mw-headline" id="Subspeed_manipulation">Subspeed manipulation</span></h5>
<p>As there exists no possible acceleration value that sets <code>FrictionAdderLow</code> to 0 (on NTSC), Mario's subspeed will fluctuate even when his speed is capped. His subspeed can be frozen by releasing all directional inputs while in the air, useful for manipulating the speed at which Mario will accelerate. A common example is releasing right for one frame in order to maintain a subspeed of 0xF0 following a L+R fast acceleration, allowing Mario to reach the maximum running speed slightly faster.
</p>
<h3><span class="mw-headline" id="Speed_resets">Speed resets</span></h3>
<p>Mario's speed is reset when:
</p>
<ul><li>Mario collides with a wall</li>
<li>Mario collides with the left side of the screen while holding either Left (0x02), L+R (0x03) or nothing (0x00)</li>
<li>Mario walks more than one pixel into a horizontal pipe</li>
<li>Mario dies</li></ul>
<p>Mario's speed and subspeed are reset when:
</p>
<ul><li>Mario enters a screen transition</li>
<li>When Mario's absolute speed is less than 11, and any button (other than A and the direction Mario is traveling) is pressed</li></ul>
<h3><span class="mw-headline" id="Miscellaneous">Miscellaneous</span></h3>
<ul><li>When Mario collects a powerup, the game will consider Mario to be on the ground for exactly one frame, allowing <code>RunningTimer</code> to be set. This can be exploited as you can obtain running speed in the air after grabbing a powerup. This is used in the category "1-1 as Fire Mario" where the fire flower grab is called a darG grab.</li>
<li>Leftward movement is fundamentally different than rightward movement, as e.g. +0xD0 speed is stored as 00 D0, however -0xD0 speed is stored as FF 30 (upper byte signed two's complement), allowing Mario to move one subpixel left after only one frame of input from standby (00 00). This allows for fast y-subpixel manipulation off the left edge of a platform, as Mario can oscillate between -1 and 1 speed very quickly.</li></ul>
<h3><span id="Wind_.28SMB2J.29"></span><span class="mw-headline" id="Wind_(SMB2J)">Wind (SMB2J)</span></h3>
<p>In SMB2J, depending on whether the most significant bit of the frame counter is set, wind pushes Mario by one pixel every two or four frames (<code>FrameCounter &amp; 0b10000000&nbsp;? 2&nbsp;: 4</code>). This can be exploited as a method to clip into walls with much more leniency than normal, or even to fully clip while Mario is traveling downwards, which is otherwise impossible.
</p>
<h2><span class="mw-headline" id="Vertical_movement">Vertical movement</span></h2>
<p>Vertical movement behaves much like horizontal movement, where a positive speed (<code>Player_Y_Speed</code>) represents downwards movement and a negative speed represents upwards movement. Unlike with horizontal movement, Mario's subspeed (<code>Player_Y_MoveForce</code>) is applied to his subpixel value, as vertical movement would be jarring otherwise.
</p>
<h3><span class="mw-headline" id="Speed_cap">Speed cap</span></h3>
<p>The vertical speed cap for all sprite objects (including Mario) is implemented poorly. It checks for whether the object's speed and subspeed both exceed their respective intended caps (<code>SprObject_Y_Speed,x &gt;= $02 <b>and</b> SprObject_Y_MoveForce,x &gt;= 0x80</code>), forgetting to account for when it's speed is above the cap, but it's subspeed is below the cap (<code>SprObject_Y_Speed,x &gt; $02</code> and <code>SprObject_Y_MoveForce,x &lt; 0x80</code>). This allows Mario (and all other sprite objects) to exceed the intended speed cap, with precise subspeed manipulation (e.g. differing jump heights, ceiling bonks, enemy bounces). This is generally useless on NTSC, however it can be used in the PAL version to clip into the floor.
</p>
<h3><span class="mw-headline" id="Gravity">Gravity</span></h3>
<p>Mario's gravity is only set under 4 different conditions:
</p>
<ul><li>When going through a screen transition, Mario's downwards gravity is set to 0x28</li>
<li>When Mario is above bounds in a water area, Mario's downwards gravity is set to 0x18</li>
<li>When Mario lands on a spring, his upwards gravity is set to 0x70</li>
<li>When Mario jumps or swims (bouncing off a spring does not count, however jumping off a spring does count), his upwards and downwards gravity is set following this algorithm:</li></ul>
<pre><b>if</b> Player_State == 0 <b>or</b> (SwimmingFlag&nbsp;!= 0 <b>and</b> (JumpSwimTimer&nbsp;!= 0 <b>or</b> Player_Y_Speed &gt;= 0)) <b>then</b> /* If Mario is on the ground, or Mario is swimming and either JumpSwimTimer is set or his speed is nonnegative */
    JumpSwimTimer&nbsp;:= 32 /* Reset timer */
    y_register&nbsp;:= 0
    Player_YMF_Dummy&nbsp;:= 0 /* Reset y subpixel */
    
    JumpOrigin_Y_Position&nbsp;:= Player_Y_Position /* Used for an edge case at the very beginning of Mario's jump where Player_Y_Speed &lt; 0 and A_B_Buttons &amp; PreviousA_B_Buttons &amp; 0b10000000 == 0 */
    Player_State&nbsp;:= 1
    
    <b>for</b> i&nbsp;:= 0; i &lt; 4 <b>do</b>
        <b>if</b> Player_XSpeedAbsolute &lt; [9, 16, 25, 28][i] <b>then</b>
            <b>break</b>
        <b>end</b>
        
        y_register&nbsp;:= y_register + 1 /* Increment for gravity calculation */
    <b>end</b>
    
    <b>if</b> SwimmingFlag&nbsp;!= 0 <b>then</b> /* If Mario is swimming */
        y_register&nbsp;:= 5
        
        <b>if</b> Whirlpool_Flag&nbsp;!= 0 <b>then</b> /* If Mario is in a whirlpool */
            y_register&nbsp;:= y_register + 1
        <b>end</b>
    <b>end</b>
    
    VerticalForce&nbsp;:= JumpMForceData[y_register] /* db[0x20, 0x20, 0x1e, 0x28, 0x28, 0x0d, 0x04] */
    VerticalForceDown&nbsp;:= FallMForceData[y_register] /* db[0x70, 0x70, 0x60, 0x90, 0x90, 0x0a, 0x09] */
    Player_Y_MoveForce&nbsp;:= InitMForceData[y_register] /* db[0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00] */
    Player_Y_Speed&nbsp;:= PlayerYSpdData[y_register] /* db[0xfc, 0xfc, 0xfc, 0xfb, 0xfb, 0xfe, 0xff] */
    
    <b>if</b> SwimmingFlag&nbsp;!= 0 <b>and</b> Player_Y_Position &lt; 20 <b>then</b> /* Check if above bounds in water areas */
        Player_Y_Speed&nbsp;:= 0
    <b>end</b>
<b>end</b>
</pre>
<p>Note that upwards and downwards gravity are stored in <code>VerticalForce</code> and <code>VerticalForceDown</code> respectively. Only <code>VerticalForce</code> is ever applied to Mario's speed and subspeed. <code>VerticalForceDown</code> is copied to <code>VerticalForce</code> when Mario is in the air and either his speed is greater or equal to zero, or the A button has been released.
</p>
<h3><span class="mw-headline" id="Speed_resets_2">Speed resets</span></h3>
<p>Mario's speed is set in the following conditions:
</p>
<ul><li>When Mario jumps, his speed is set to <code>PlayerYSpdData[y_register]</code>, and his subspeed is set to <code>InitMForceData[y_register]</code> (see pseudocode above for dbs).</li>
<li>When Mario bumps a soft block, his vertical speed is set to 0 if the block does not break, or -2 if it does. His subspeed is not changed.</li>
<li>When Mario bumps a hard block (including when the bump timer has not reset yet, as all blocks are hard) or the bottom of a moving platform, his speed is set to 1. His subspeed is not changed. Note that all blocks in water areas are hard.</li>
<li>When Mario dies onscreen, his speed is set to -4 and his gravity is set and frozen to 0x28. His subspeed is not changed.</li>
<li>In SMB1, if you bounce off a Cheep Cheep, Bullet Bill, Podoboo, Hammer Bro, Lakitu, or a Blooper Mario's speed is set to -3. Any other enemy will set his speed to -4. His subspeed is not changed. [ADD SMB2J]</li>
<li>When Mario lands on anything, his speed and subspeed is reset to 0.</li>
<li>When Mario is climbing, his speed is set to -1 and his subspeed is set to 0x20 when climbing up, or 1 and 0xff when climbing down.</li>
<li>When Mario bounces on a red spring, his speed is set to -12 if A is held, or -7 otherwise. His subspeed is not explicitly reset however it is always reset beforehand when he lands on the spring. [ADD SMB2J]</li></ul>

</body></html>