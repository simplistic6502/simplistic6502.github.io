<!DOCTYPE html>
<!-- saved from url=(0042)https://www.smbpedia.com/wiki/TAS_Encoding -->
<html class="client-js ve-available" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/main.css">
<title>TAS Encoding - SMBpedia</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"ZXHZOYXg3KUDlJEBnj0d-AAAAEg","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"TAS_Encoding","wgTitle":"TAS Encoding","wgCurRevisionId":253,"wgRevisionId":253,"wgArticleId":66,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"TAS_Encoding","wgRelevantArticleId":66,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr",
"pageVariantFallbacks":"en"},"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false},"wgVector2022PreviewPages":[],"wgEditSubmitButtonLabelPublish":false};RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","skins.vector.styles.legacy":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});</script>
<link rel="stylesheet" href="./TAS Encoding - SMBpedia_files/load.php">
<script async="" src="./TAS Encoding - SMBpedia_files/load(1).php"></script>
<meta name="generator" content="MediaWiki 1.40.1">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<link rel="icon" href="https://www.smbpedia.com/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://www.smbpedia.com/opensearch_desc.php" title="SMBpedia (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://www.smbpedia.com/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="SMBpedia Atom feed" href="https://www.smbpedia.com/index.php?title=Special:RecentChanges&amp;feed=atom">
<style>
.mw-editfont-monospace{font-family:monospace,monospace}.mw-editfont-sans-serif{font-family:sans-serif}.mw-editfont-serif{font-family:serif} .mw-editfont-monospace,.mw-editfont-sans-serif,.mw-editfont-serif{  font-size:13px;  -moz-tab-size:4; tab-size:4; }.mw-editfont-monospace.oo-ui-textInputWidget,.mw-editfont-sans-serif.oo-ui-textInputWidget,.mw-editfont-serif.oo-ui-textInputWidget{font-size:inherit}.mw-editfont-monospace.oo-ui-textInputWidget > .oo-ui-inputWidget-input,.mw-editfont-sans-serif.oo-ui-textInputWidget > .oo-ui-inputWidget-input,.mw-editfont-serif.oo-ui-textInputWidget > .oo-ui-inputWidget-input{  font-size:13px}.mw-editfont-monospace.oo-ui-textInputWidget > input.oo-ui-inputWidget-input,.mw-editfont-sans-serif.oo-ui-textInputWidget > input.oo-ui-inputWidget-input,.mw-editfont-serif.oo-ui-textInputWidget > input.oo-ui-inputWidget-input{min-height:32px}
.ve-init-mw-progressBarWidget{height:1em;overflow:hidden;margin:0 25%}.ve-init-mw-progressBarWidget-bar{height:1em;width:0} .ve-init-mw-progressBarWidget{background-color:#fff;box-sizing:border-box;height:0.875em;border:1px solid #36c;border-radius:0.875em;box-shadow:0 1px 1px rgba(0,0,0,0.15)}.ve-init-mw-progressBarWidget-bar{background-color:#36c;height:0.875em}
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><style>
.ve-init-mw-tempWikitextEditorWidget{border:0;padding:0;color:inherit;line-height:1.5em;width:100%; -moz-tab-size:4; tab-size:4; }.ve-init-mw-tempWikitextEditorWidget:focus{outline:0;padding:0}.ve-init-mw-tempWikitextEditorWidget::selection{background:rgba(109,169,247,0.5); }</style><style>
.ve-active .ve-init-mw-desktopArticleTarget-targetContainer #siteNotice,.ve-active .mw-indicators,.ve-active #t-print,.ve-active #t-permalink,.ve-active #p-coll-print_export,.ve-active #t-cite,.ve-active .ve-init-mw-desktopArticleTarget-editableContent,.ve-active .ve-init-mw-tempWikitextEditorWidget{display:none}.ve-deactivating .ve-ui-surface{display:none}.ve-activating{ }.ve-activating .ve-ui-surface{height:0;padding:0 !important; overflow:hidden} .ve-loading .ve-init-mw-desktopArticleTarget-targetContainer > :not(.ve-init-mw-desktopArticleTarget-toolbarPlaceholder):not(.ve-init-mw-desktopArticleTarget),.ve-loading .ve-init-mw-desktopArticleTarget-originalContent,.ve-activated:not(.ve-loading) .ve-init-mw-desktopArticleTarget-uneditableContent{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.5}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading{ -webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;pointer-events:auto;cursor:text}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading a{ pointer-events:none}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks{cursor:pointer}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks:hover{ background:#e9f2fd}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks a{opacity:1} .ve-init-mw-desktopArticleTarget-loading-overlay{z-index:2;position:absolute;width:100%;top:1em}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{overflow:hidden;transition:height 250ms ease;height:0;padding-bottom:2px; }.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(-100%);transition:transform 250ms ease}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(0)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{transition:none}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{position:fixed;top:0;z-index:1;background:#fff} .oo-ui-element-hidden{display:none !important; } .mw-editsection{ unicode-bidi:-moz-isolate;unicode-bidi:-webkit-isolate;unicode-bidi:isolate}.mw-editsection:before{content:'\200B'}.mw-editsection a{white-space:nowrap}.mw-editsection-divider{color:#54595d} .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{height:42px;border-bottom:1px solid #c8ccd1;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open{height:42px} .ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{font-size:0.875em; margin:-1.14em -1.14em 1.14em -1.14em; }@media screen and (min-width:982px){.ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{ margin:-1.43em -1.71em 1.43em -1.71em}}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{margin-top:0;margin-bottom:0} .ve-activated .vector-menu-tabs .selected{box-shadow:inset 0 -1px 0 #e1f1fc}</style></head>
<body class="skin-vector-legacy mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-TAS_Encoding rootpage-TAS_Encoding skin-vector action-view"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body ve-init-mw-desktopArticleTarget-targetContainer" role="main">
	<a id="top"></a>
	<div id="siteNotice"></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">TAS Encoding</span></h1>
	<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Encoding_TASes_with_FCEUX"><span class="tocnumber">1</span> <span class="toctext">Encoding TASes with FCEUX</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Prerequisites"><span class="tocnumber">1.1</span> <span class="toctext">Prerequisites</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Dumping_a_raw_AVI_file"><span class="tocnumber">1.2</span> <span class="toctext">Dumping a raw AVI file</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Before_Encoding"><span class="tocnumber">1.3</span> <span class="toctext">Before Encoding</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Merging_videos"><span class="tocnumber">1.4</span> <span class="toctext">Merging videos</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Encoding_the_final_video"><span class="tocnumber">1.5</span> <span class="toctext">Encoding the final video</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Additional_content"><span class="tocnumber">1.6</span> <span class="toctext">Additional content</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#More_complicated_encodes"><span class="tocnumber">1.7</span> <span class="toctext">More complicated encodes</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Encoding_TASes_with_FCEUX">Encoding TASes with FCEUX</span></h2>
<h3><span class="mw-headline" id="Prerequisites">Prerequisites</span></h3>
<p>FFmpeg: Installation for <a href="https://www.wikihow.com/Install-FFmpeg-on-Windows" class="extiw" title="wikihow:Install-FFmpeg-on-Windows">Windows</a> and <a rel="nofollow" class="external text" href="https://linuxize.com/post/how-to-install-ffmpeg-on-debian-9/">Linux</a>
</p><p>For Mac users, You would first have to install Homebrew, then run
</p><p><code>$ brew install ffmpeg</code>
</p><p>in the Terminal.
</p><p><br>
FCEUX: <a rel="nofollow" class="external text" href="https://fceux.com/web/download.html">Download Link</a>
</p><p>For Windows users, download and extract the Win32 binary, and for Linux and Mac users download the latest development build if you do not want to build it yourself.
</p><p><br>
Optional but highly recommended on Windows - Lagarith: <a rel="nofollow" class="external text" href="https://lags.leetcode.net/codec.html">Download Link</a> 
</p><p>Download and open the installer to install.
</p><p>You should also have a significant amount of storage left depending on the length of your TAS.
</p>
<h3><span class="mw-headline" id="Dumping_a_raw_AVI_file">Dumping a raw AVI file</span></h3>
<p>Open the TAS editor for the most convenient dumping process.
</p><p>If you would like just the gameplay without any HUD elements, disable HUD recording in File &gt; AVI/WAV. If you would like the HUD elements, configure the HUD via Config &gt; Display and enable HUD recording.
</p><p>Trim your movie until you are satisfied with the endpoint, pick a starting point (First frame for most cases) and go to File &gt; AVI/WAV and press Record AVI. Save the file wherever you want and when asked for video compression, select Lagarith (or Uncompressed, if you have not installed it).
</p><p>Play back the whole movie (Turbo may cause issues, such as skipped frames or pitched audio), and when its done, go back to File &gt; AVI/WAV and press Stop AVI.
</p>
<h3><span class="mw-headline" id="Before_Encoding">Before Encoding</span></h3>
<p>Navigate to Config &gt; Sound, and make sure all volume sliders are maxed, and quality is set to Highest. You can also change the color palette in Config &gt; Palette.
</p><p>Locate the directory containing your AVI file(s), and if you see one file, skip ahead to "Encoding the final video".
</p><p>If you see multiple files, continue to "Merging videos".
</p>
<h3><span class="mw-headline" id="Merging_videos">Merging videos</span></h3>
<p>If several videos have appeared in the directory you have selected, named
</p>
<pre>video.avi
video_part2.avi
video_part3.avi
</pre>
<p>First create a text file named input.txt, with the following contents:
</p>
<pre>file 'Drive:\path\to\file\video.avi'
file 'Drive:\path\to\file\video_part2.avi'
file 'Drive:\path\to\file\video_part3.avi'
</pre>
<p>And (IMPORTANT!) make sure the text file is encoded in UTF-8.
</p><p>Then open any command line in the directory containing the text file (in this case the same directory as the video files) then run
</p><p><code>ffmpeg -f concat -safe 0 -i input.txt -c:v ffv1 -c:a copy input.mkv</code>
</p><p>This creates a new lossless video file named input.mkv containing the entire movie. You may
now delete the original dumped videos, as they are not necessary anymore.
</p>
<h3><span class="mw-headline" id="Encoding_the_final_video">Encoding the final video</span></h3>
<p>If your movie is short enough for it to fit in a single dumped video file (or you are using Lagarith), rename the video to input and run
</p><p><code>ffmpeg -i input.avi -c:v libx264 -pix_fmt yuv420p -c:a copy -vf scale=iw*FACTOR:ih*FACTOR -sws_flags neighbor output.mkv</code>
</p><p>Likewise, if you have just merged several video files, run
</p><p><code>ffmpeg -i input.mkv -c:v libx264 -pix_fmt yuv420p -c:a copy -vf scale=iw*FACTOR:ih*FACTOR -sws_flags neighbor output.mkv</code>
</p><p>where FACTOR is the scaling factor in which you want to scale your video. 4 is the minimum recommended value, which corresponds to around 1080p.
If for some reason your scaling factor is smaller than 4, omit -pix_fmt yuv420p for the best quality (however keep it if it’s destined to be uploaded to Discord).
</p><p>To set the aspect ratio, you can add -aspect X:Y after specifying the input.
</p><p>Additionally, if you would like higher quality (particularly for lower resolution encodes), add
</p><p><code>-crf 18 after -c:v libx264.</code>
</p><p>Note if you are using Lagarith: FFmpeg may throw errors at the end of encoding, this should always be fine as we are using the matroska (mkv) container.
</p>
<h3><span class="mw-headline" id="Additional_content">Additional content</span></h3>
<p>If you would like additional content besides the gameplay (Lua input display/stats display or even another instance of gameplay if you a doing a comparison), you can horizontally or vertically stack two videos using
</p><p><code>ffmpeg -i left.mkv -i right.mkv -filter_complex hstack -c:v ffv1 -c:a copy output.mkv</code>
</p><p>or
</p><p><code>ffmpeg -i top.mkv -i bottom.mkv -filter_complex vstack -c:v ffv1 -c:a copy output.mkv</code>
</p><p>respectively. For more complex stacking, see <a rel="nofollow" class="external text" href="https://stackoverflow.com/questions/11552565/vertically-or-horizontally-stack-mosaic-several-videos-using-ffmpeg">this</a> Stack Overflow thread.
Afterwards, if needed, you can crop the video before upscaling using ffmpeg's crop filter:
</p><p><code>ffmpeg -i input.mkv -filter:v "crop=WIDTH:HEIGHT:XCOORD:YCOORD" -c:v libx264 -c:a copy -vf scale=iw*FACTOR:ih*FACTOR -sws_flags neighbor output.mkv</code>
</p><p>where WIDTH:HEIGHT is the width and height of the cropped video, XCOORD:YCOORD is the
position of the top left corner of the cropped video.
</p>
<h3><span class="mw-headline" id="More_complicated_encodes">More complicated encodes</span></h3>
<p>For more complicated encodes such as a comparison video which includes a timer, time difference and statistics, I would recommend a free video editor such as <a rel="nofollow" class="external text" href="https://shotcut.org/download/">Shotcut</a> or <a rel="nofollow" class="external text" href="https://www.blackmagicdesign.com/products/davinciresolve/">DaVinci Resolve</a> (Resolve offers a free version, however be warned that Resolve doesn't support matroska).
</p><p>Configure the video to 60.098814fps (or 50.006979fps for PAL) progressive scan, and configure the audio to pcm_s16 CBR 768kbps.
</p>

</body></html>